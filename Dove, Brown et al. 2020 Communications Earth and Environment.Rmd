---
title: "R Notebook"
output:
  pdf_document: default
  html_document:
    df_print: paged
---
#Dove et al. 2020 Ocean warming and acidification uncouple calcification from calcifier biomass accelerating coral reef decline. Communications Earth and Environment
##script by Kristen Brown with Sophie Dove

```{r}
library(dplyr)
library(Rmisc)
library(lubridate)
library(ggplot2)
library(mgcv)
library(car)
library(MuMIn)
library(MASS)
library(gridExtra)
library(lattice)
library(emmeans)
```
#Repeated measures ANOVA evaluating the effects of temperature, pCO2 and time of day on calcification rates

```{r}
alk3treat<- read.csv("/Users/imkri/Desktop/Meso/Calcification exp 3 new Feb2019SD.csv", strip.white=T)
alk3treat
```

```{r}
alk3.lm<- lm(gCaCO3h.1m.2~Temperature*pCO2*Time, data=alk3treat) #Gaussian
par(mfrow=c(2,3))
plot(alk3.lm, ask=FALSE, which=1:6)
```

```{r}
repeatedmeasurestreat<- lme(gCaCO3h.1m.2~Temperature*pCO2*Time, random=~1|Tank, data=alk3treat, method="REML", na.action = na.exclude)
repeatedmeasurestreat
new<-aov(repeatedmeasurestreat)
summary(new)
tukeytreat<- emmeans(repeatedmeasurestreat, list(pairwise ~ Temperature:pCO2:Time), adjust = "tukey")
tukeytreat
```

```{r}
alk3sumtime<-summarySE(alk3treat, measurevar='gCaCO3h.1m.2', groupvars=c('Treatment', 'Time'), na.rm=TRUE, conf.interval = 0.95)
alk3sumtime
```

```{r}
alk3sumtime$Treatment<- factor(alk3sumtime$Treatment, levels =c("Blue","Green","Yellow","Red"))
alk3sumtime$Time<- factor(alk3sumtime$Time, levels =c("7:00","12:00","18:00","0:00"))
alk3figtime<-ggplot(alk3sumtime, aes(y=gCaCO3h.1m.2, x=Time, fill=Treatment))+
  geom_bar(color="black",stat="identity", position=position_dodge(), alpha=0.7)+
  geom_errorbar(aes(ymin=gCaCO3h.1m.2-se, ymax=gCaCO3h.1m.2+se), width=0.3, position=position_dodge(.9))+
  scale_fill_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_x_discrete(expression(Time~of~day))+
  scale_y_continuous(expression(Net~ecosystem~calcification~(gCaC0[3]~'\U2219'~hr^{-1}~'\U2219'~m^{-2})), breaks=c(-0.3,-0.15,0.0,0.15,0.3,0.45,0.60,0.75,0.90))+
  geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        legend.position = "none",
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_text(vjust=0.5, size=12),#making the axis title larger 
        axis.title.y = element_text(vjust=0.5, size=12))#making the axis title larger 
alk3figtime
```

#Repeated measures ANOVA evaluating the effect of treatment and month on 24hour calcification 

```{r}
meso3 <- read.csv("/Users/imkri/Desktop/Meso/Calcification over 24hr Sep14- Mar16.csv", strip.white=T)
meso3$Month<-as.factor(meso3$Month)
head(meso3)
```

```{r}
meso3sum<-summarySE(meso3, measurevar='gCaCO3h.1m.2', groupvars=c('Treatment','Date'), na.rm=TRUE, conf.interval = 0.95)
meso3sum
```

```{r}
meso3sum$Date<- as.Date(as.POSIXct(meso3sum$Date, origin="1970-01-01"))
meso3sum$Treatment <- factor(meso3sum$Treatment, levels=c("Blue","Green","Yellow","Red"))
meso3ribbonfig<-ggplot(meso3sum, aes(y=gCaCO3h.1m.2, x=Date,fill=Treatment))+
  geom_ribbon(aes(ymin=gCaCO3h.1m.2-se, ymax=gCaCO3h.1m.2+se), alpha=0.4)+
  geom_line(aes(color=Treatment),alpha=0.8)+
  scale_fill_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_color_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  scale_y_continuous(expression(Net~community~calcification~(gCaC0[3]~'\U2219'~day^{-1}~'\U2219'~m^{-2})), limits= c(-3.5, 16.5), breaks=c(-2.5,0.0,2.5,5,7.5,10, 12.5,15))+
  geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2014-12-29")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(vjust=0.5, size=12))#making the axis title larger 
meso3ribbonfig
```

```{r}
cal24hr<- lme(gCaCO3.24h.1~Treatment*Month, random=~1|Tank, data=meso3, method="REML", na.action = na.exclude)
cal24hr
summary(cal24hr)
Anova(cal24hr)
tukey24hr<- emmeans(cal24hr, list(pairwise ~ Treatment:Month), adjust = "tukey")
tukey24hr
```

#PERMANOVA on effect of treatment on benthic community composition

```{r}
mds3<- read.csv("/Users/imkri/Desktop/Meso/Data/Experiment 3 Dec14- Feb16 BandTB combined.csv", strip.white=T)
mds3
```

```{r}
library(vegan)
benthic.adonis<-adonis(mds3[,(9:44)] ~Treatment, random=~1|Tank.Number, data=mds3, permutations = 9999)
benthic.adonis
```

#Repeated measures ANOVA evaluating the effects of treatment on hard coral cover

```{r}
hctreat <- read.csv("/Users/imkri/Desktop/Meso/Data/Experiment 3 no acclimation sum percent.csv", strip.white=T)
head(hctreat)
```

```{r}
hctreat.lme<- lme(All.hard.coral..~Treatment, random=~1|Tank.Number, data=hctreat, method="REML", na.action = na.exclude)
hctreat.lme
summary(hctreat.lme)
Anova(hctreat.lme)
hctreattukey<- emmeans(hctreat.lme, list(pairwise ~ Treatment), adjust = "tukey")
hctreattukey
```

#Figure of benthic cover over time

```{r}
meso3ben <- read.csv("/Users/imkri/Desktop/Meso/Data/Benthic cover 3 bleach + live coral.csv", strip.white=T)
head(meso3ben)
```

```{r}
meso3sumben<-summarySE(meso3ben, measurevar='Cover', groupvars=c('Treatment', 'Date','Category'), na.rm=TRUE, conf.interval = 0.95)
meso3sumben
```

```{r}
meso3sumben$Date<- as.Date(as.POSIXct(meso3sumben$Date, origin="1970-01-01"))
meso3sumben$Treatment <- factor(meso3sumben$Treatment, levels=c("B","G","Y","R"))
meso3sumben$Category <- factor(meso3sumben$Category, levels=c("Hard coral","Bleached hard coral","Calcifying algae","Macroalgae","Cyanobacteria"))
meso3ribbonfigbenthic<-ggplot(meso3sumben, aes(y=Cover, x=Date,fill=Treatment))+
  geom_ribbon(aes(ymin=Cover-se, ymax=Cover+se), alpha=0.4)+
  #geom_errorbar(aes(ymin=Calcification..gCaCO3.h.1.-se, ymax=Calcification..gCaCO3.h.1.+se), width=0.3, position=pd)+
  geom_line(aes(color=Treatment),alpha=0.8)+
  #geom_point(aes(color=Treatment))+
  facet_grid(Category~.)+
  scale_fill_manual("Treatment", values=c("B"= 'navy',"G"= "mediumaquamarine", "Y"='orange2', "R"= 'brown1'),
                    labels=c("B"="Present day", "G"="RCP8.5 pCO2", "Y"="RCP8.5 temp", "R"="RCP8.5 temp & pCO2"))+
  scale_color_manual("Treatment", values=c("B"= 'navy',"G"= "mediumaquamarine", "Y"='orange2', "R"= 'brown1'),
                    labels=c("B"="Present day", "G"="RCP8.5 pCO2", "Y"="RCP8.5 temp", "R"="RCP8.5 temp & pCO2"))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  scale_y_continuous(expression(Percent~cover~"(%)"))+
  #geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  geom_vline(xintercept=as.numeric(as.Date("2014-12-29")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(vjust=0.5, size=12))#making the axis title larger 
meso3ribbonfigbenthic
```
```{r}
meso3bencp <- read.csv("/Users/imkri/Desktop/Meso/Calcifiers and Photosynthesizers.csv", strip.white=T)
head(meso3bencp)
```
```{r}
meso3sumbenc<-summarySE(meso3bencp, measurevar='Calcifiers', groupvars=c('Treatment', 'Date'), na.rm=TRUE, conf.interval = 0.95)
meso3sumbenc
```
```{r}
meso3sumbenc$Date<- as.Date(as.POSIXct(meso3sumbenc$Date, origin="1970-01-01"), na.rm=TRUE)
meso3sumbenc$Treatment <- factor(meso3sumbenc$Treatment, levels=c("Blue","Green","Yellow","Red"))
meso3ribbonfigbenthiccal<-ggplot(meso3sumbenc, aes(y=Calcifiers, x=Date,fill=Treatment))+
  geom_ribbon(aes(ymin=Calcifiers-se, ymax=Calcifiers+se), alpha=0.4)+
  geom_line(aes(color=Treatment),alpha=0.8)+
  scale_fill_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_color_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine","Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  scale_y_continuous(expression(Percent~cover~"(%)"), limits=c(0,90), breaks= c(0,25,50,75))+
  #geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2014-12-29")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(vjust=0.5, size=12))#making the axis title larger 
meso3ribbonfigbenthiccal
```
```{r}
meso3sumbenp<-summarySE(meso3bencp, measurevar='Photosynthesizers', groupvars=c('Treatment', 'Date'), na.rm=TRUE, conf.interval = 0.95)
meso3sumbenp
```
```{r}
meso3sumbenp$Date<- as.Date(as.POSIXct(meso3sumbenp$Date, origin="1970-01-01"), na.rm=TRUE)
meso3sumbenp$Treatment <- factor(meso3sumbenp$Treatment, levels=c("Blue","Green","Yellow","Red"))
meso3ribbonfigbenthicphoto<-ggplot(meso3sumbenp, aes(y=Photosynthesizers, x=Date,fill=Treatment))+
  geom_ribbon(aes(ymin=Photosynthesizers-se, ymax=Photosynthesizers+se), alpha=0.4)+
  geom_line(aes(color=Treatment),alpha=0.8)+
  scale_fill_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_color_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine","Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  scale_y_continuous(expression(Percent~cover~"(%)"), limits=c(0,90))+
  #geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  #geom_vline(xintercept=as.numeric(as.Date("2014-12-29")), linetype="dashed", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(vjust=0.5, size=12))#making the axis title larger 
meso3ribbonfigbenthicphoto
```

#Repeated measures ANOVA evaluating the effects of treatment on photosynthesizers (macroalgae, calcifying macroalgae, cyanobacteria) 

```{r}
photo <- read.csv("/Users/imkri/Desktop/Meso/Photosynthesizers cover over time Dec14-Feb16.csv", strip.white=T)
head(photo)
```

```{r}
phototreat.lme2<- lme(Photosyn.no.coral~Treatment, random=~1|Tank.Number, data=photo, method="REML", na.action = na.exclude)
phototreat.lme2
summary(phototreat.lme2)
Anova(phototreat.lme2)
tukeytreat<- emmeans(phototreat.lme2, list(pairwise ~ Treatment), adjust = "tukey")
tukeytreat
```
#Repeated measures ANOVA evaluating the effects of treatment on midday sump v. tank pCO2 concentrations

```{r}
tankvsump<- read.csv("/Users/imkri/Desktop/Meso/Sump v Tank pco2.csv", strip.white=T)
tankvsump
```

```{r}
tankvsump.lme<- lme(pCO2.1~Treatment*Aquaria, random=~1|Tank, data=tankvsump, method="REML", na.action = na.exclude)
tankvsump.lme
Anova(tankvsump.lme)
tukeytreat<- emmeans(tankvsump.lme, list(pairwise ~ Treatment:Aquaria), adjust = "tukey")
tukeytreat
```

#Relationship between calcification and Halimeda cover in RCP8.5 pCO2 (green) treatments

```{r}
calhal <- read.csv("/Users/imkri/Desktop/Meso/Calcification v Halimeda green.csv", strip.white=T)
calhal$Tank<-as.factor(calhal$Tank)
head(calhal)
```

```{r}
lm_eqn <- function(calhal){
    m <- lm(gCaCO3h.1m.2 ~ Halimeda, calhal);
    eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2, 
         list(a = format(coef(m)[1], digits = 2), 
              b = format(coef(m)[2], digits = 2), 
             r2 = format(summary(m)$r.squared, digits = 3)))
    as.character(as.expression(eq));                 
}
lm_eqn
```

```{r}
theme_set(theme_classic()+  theme(axis.text.x=element_text(hjust=0.5, size=12), 
        legend.justification=c(0,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=14),
        axis.title.y = element_text(vjust=0.5, size=14),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=12)))
calhalfig<- ggplot(calhal, aes(x= Halimeda, y=gCaCO3h.1m.2))+
  geom_point(color='black', alpha=0.7)+
  geom_smooth(method="lm",
              formula= y ~ x,
              method.args=list(family="gaussian"), color='black', fill='grey39')+
    geom_text(x = 30, y = 20, label = lm_eqn(calhal), parse = TRUE)+
   #scale_x_continuous(expression(pCO[2]~(mu~atm)), limits=c(200,1100), breaks=c(250,500,750,1000))+
   scale_y_continuous(expression(Net~ecosystem~calcification~(gCaC0[3]~'\U2219'~hr^{-1}~'\U2219'~m^{-2})))+
  geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)
calhalfig
```

```{r}
calhal.lm <-lme(gCaCO3h.1m.2~Halimeda, random=~1|Tank, data=calhal, method="REML", na.action = na.exclude)
calhal.lm
summary(calhal.lm)
Anova(calhal.lm)
```

#Repeated measures ANOVA evaluating the effects of treatment on bleached coral in November 2014

```{r}
bleach <- read.csv("/Users/imkri/Desktop/Meso/Data/Experiment 3 Dec14 BandTB combined.csv", strip.white=T)
bleach$Tank<-as.factor(bleach$Tank)
head(bleach)
```

```{r}
bleachdec14<- lme(all.bleached.coral~Treatment, random=~1|Tank.Number, data=bleach, method="REML", na.action = na.exclude)
bleachdec14
summary(bleachdec14)
Anova(bleachdec14)
tukeybleach<- emmeans(bleachdec14, list(pairwise ~ Treatment), adjust = "tukey")
tukeybleach
```
#Environmental condition figures

```{r}
pCO2<- read.csv("/Users/imkri/Desktop/Meso/pCO2 exp 3.csv", strip.white=T)
pCO2
```

```{r}
library(dplyr)
pCO2_quantilesQ3<-pCO2%>%
  group_by(Treatment, Date.1)%>%
  summarize_at(vars(CO2.Valve), funs(Q3 = quantile), probs = 0.975,na.rm=T)
pCO2_quantilesQ3
```

```{r}
pCO2_quantilesQ1<-pCO2%>%
  group_by(Treatment, Date.1)%>%
  summarize_at(vars(CO2.Valve), funs(Q1 = quantile), probs = 0.025,na.rm=T)
pCO2_quantilesQ1
```

```{r}
pCO2_2<-inner_join(pCO2_quantilesQ1,pCO2)
pCO2_2
```

```{r}
pCO2_2<-inner_join(pCO2_quantilesQ3,pCO2_2)
pCO2_2
```

```{r}
pCO2_2<-pCO2_2%>%
  mutate(pCO2_clean=ifelse(CO2.Valve < Q1 | CO2.Valve >Q3, NA,CO2.Valve)) 
pCO2_2
```

```{r}
pCO2sum<-summarySE(pCO2_2, measurevar='pCO2_clean', groupvars=c('Treatment','Date.1'), na.rm=TRUE, conf.interval = 0.95)
pCO2sum
```

```{r}
library(ggplot2)
pCO2sum$Date<- as.Date(as.POSIXct(pCO2sum$Date, origin="1970-01-01"))
pCO2sum$Treatment <- factor(pCO2sum$Treatment, levels=c("Blue","Red","Yellow","Green"))
pCO2sumfig<-ggplot(pCO2sum, aes(y=pCO2_clean, x=Date,fill=Treatment))+
  geom_line(aes(color=Treatment),alpha=0.8)+
  scale_fill_manual("Treatment", values=c("Blue"= 'navy',"Green"= 'brown1', "Yellow"='orange2', "Red"="mediumaquamarine" ),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 temp & pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 pCO2"))+
  scale_color_manual("Treatment", values=c("Blue"= 'navy',"Green"= 'brown1', "Yellow"='orange2', "Red"="mediumaquamarine" ),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 temp & pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 pCO2"))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  scale_y_continuous(expression(pCO[2]), breaks= c(300,400, 500, 600, 700, 800, 900, 1000, 1100))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank())#making the axis title larger 
pCO2sumfig
```

```{r}
mesotempexp3sum <- read.csv("/Users/imkri/Desktop/Meso/Temp exp3 Dec14-Mar16.csv", strip.white=T)
mesotempexp3sum
```

```{r}
mesotempexp3sum$Date<- as.Date(as.POSIXct(mesotempexp3sum$Date, origin="1970-01-01"))
```

```{r}
library(ggplot2)
mesotemp3<-ggplot(mesotempexp3sum, aes(y=Temperature, x=Date,color=Treatment))+
  geom_line(alpha=0.8)+
  scale_color_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1', "Black"= "grey", "Grey"="black"),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2", "Black"= "PD DHW", "Grey"= "RCP8.5 DHW"))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  scale_y_continuous(expression(Temperature~(degree ~ C)), breaks= c(20, 22, 24, 26, 28, 30, 32))+
  geom_hline(yintercept = 27.2, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(vjust=0.5, size=12))#making the axis title larger 
mesotemp3
```

```{r}
DHW3<-ggplot(mesotempexp3sum, aes(y=Average.DHW, x=Date,color=Treatment))+
  geom_line(alpha=0.8, linetype="dashed")+
  scale_color_manual("Treatment", values=c("Blue"= 'grey76',"Green"= "grey76", "Yellow"='black', "Red"= 'black'))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  scale_y_continuous(sec.axis = sec_axis(~., name= "Degree Heating Weeks", breaks=c(0,5,10,15,20,25)))+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_text(vjust=0.5, size=12))#making the axis title larger 
DHW3
```
```{r}
conditions<-read.csv("/Users/imkri/Desktop/Meso/Environmental conditions during sampling Dec14- Feb16.csv", strip.white=T)
conditions
```
```{r}
conditionstime<-read.csv("/Users/imkri/Desktop/Meso/Environmental conditions long.csv", strip.white=T)
conditionstime
```
```{r}
meso3conditionstime<-summarySE(conditionstime, measurevar='Value', groupvars=c('Treatment','Date','Parameter'), na.rm=TRUE, conf.interval = 0.95)
meso3conditionstime
```
```{r}
write.csv(meso3conditionstime, "environ conditions by date exp 3.csv")
```

```{r}
library(Rmisc)
meso3conditions<-summarySE(conditions, measurevar='Value', groupvars=c('Treatment', 'Date','Parameter'), na.rm=TRUE, conf.interval = 0.95)
meso3conditions
```

```{r}
library(ggplot2)
meso3conditions$Date<- as.Date(as.POSIXct(meso3conditions$Date, origin="1970-01-01"))
meso3conditions$Treatment <- factor(meso3conditions$Treatment, levels=c("Blue","Green","Yellow","Red"))
meso3conditions$Parameter <- factor(meso3conditions$Parameter, levels=c("Light","Temperature","pCO2","Ar","pH"))
meso3conditionsfig<-ggplot(meso3conditions, aes(y=Value, x=Date,fill=Treatment))+
  geom_errorbar(aes(ymin=Value-se, ymax=Value+se, color=Treatment), alpha=0.8, position=position_dodge(.9))+
  geom_line(aes(color=Treatment),alpha=0.6)+
  geom_point(aes(color=Treatment), position=position_dodge())+
  facet_grid(Parameter~., scales = "free")+
  scale_fill_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_color_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_x_date(date_breaks = "5 weeks", date_labels = "%b 20%y")+
  theme_classic()+
  theme(axis.text.x=element_text(angle=90,vjust=0.5, size=12),#angling the labels on the x-axis
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),#telling it where to position our plot title
        panel.background= element_rect(fill=NA, color='black'),#this is making the black box around the graph
        #legend.position = c(0.15,0.3),
        strip.background = element_blank(), 
        strip.text = element_blank(),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank())#making the axis title larger 
meso3conditionsfig
```
##GAMs

#Read in the daytime calcification data- this is the data updated by Sophie end of January 2019
```{r}
calday3<- read.csv("/Users/imkri/Desktop/Meso/Calcification exp 3 Dec14- Dec15 day Feb19.csv", strip.white=T)
calday3
```
#Run a bunch of different models testing for the effect of environmental conditions (light, temperature, pCO2) and/or calcifier cover on calcification rates.

```{r}
library(dplyr)
library(Rmisc)
library(lubridate)
library(ggplot2)
library(mgcv)
library(car)
library(MuMIn)
library(MASS)
library(gridExtra)
library(lattice)
```

#Read in the daytime calcification data- this is the data updated by Sophie April 2019
```{r}
calday3<- read.csv("/Users/imkri/Desktop/Meso/Cal data Dec14- Dec15 day.csv", strip.white=T)
calday3
```

```{r}
mean(calday3$pCO2..CO2SYS.NBS, na.rm=TRUE)
```

#Run a bunch of different models testing for the effect of environmental conditions (light, temperature, pCO2) and/or calcifier cover on calcification rates.
```{r}
calday3temp.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3) 
calday3pco2.gam <-gam(gCaCO3h.1m.2~
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3light.gam <-gam(gCaCO3h.1m.2~
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3OAr.gam <-gam(gCaCO3h.1m.2~
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3temppCO2.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3temppCO2inter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ 
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3) ##use te only when looking at interactions
calday3templight.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3templightinter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+
                 te(Temp,Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3pco2light.gam <-gam(gCaCO3h.1m.2~
                 s(Light, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3pco2lightinter.gam <-gam(gCaCO3h.1m.2~
                 s(Light, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 te(Light,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)  
calday3lighttemppco2.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3lighttemppCO2inter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ 
                 te(Temp,pCO2..CO2SYS.NBS, Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3lightoarpco2.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3lightoarpco2inter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+
                 te(Temp,O.Ar..CO2SYS.NBS, Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
calday3temppCO2cover.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3) 
calday3temppCO2coverinter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3) ##BEST MODEL
calday3tempcoverlight.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3) 
calday3tempcoverlightinter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+
                 te(Temp, Light, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3) 
calday3tempcoverOar.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3) 
calday3tempcoverOarinter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+
                 te(Temp,O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calday3)
newmodel.gamL <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 pCO2..CO2SYS.NBS+
                 s(Calcifiers, bs="tp", k=5)+ s(Tank,bs="re")+
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5), data=calday3)
newmodel.gamstat <-gam(gCaCO3h.1m.2~
                 poly(Temp, 2, raw="TRUE")+
                 pCO2..CO2SYS.NBS+
                 s(Calcifiers, bs="tp", k=5)+ s(Tank,bs="re")+
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5), data=calday3) #BEST MODEL
newmodel.gamCoral <-gam(gCaCO3h.1m.2~
                 poly(Temp, 2, raw="TRUE")+
                 pCO2..CO2SYS.NBS+
                 s(Coral, bs="tp", k=5)+ s(Tank,bs="re")+
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5), data=calday3)
newmodel.gamHali <-gam(gCaCO3h.1m.2~
                 poly(Temp, 2, raw="TRUE")+
                 pCO2..CO2SYS.NBS+
                 s(Hali, bs="tp", k=5)+ s(Tank,bs="re")+
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5), data=calday3) 
newmodelphoto.gamstat <-gam(gCaCO3h.1m.2~
                 poly(Temp, 2, raw="TRUE")+
                 pCO2..CO2SYS.NBS+
                 s(Photosynthesizers, bs="tp", k=5)+ s(Tank,bs="re")+
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5), data=calday3) 
```

#which one is the best model? According to AICc, newmodel.gamstat.
```{r}
AICc(calday3temp.gam,
     calday3pco2.gam,
     calday3OAr.gam,
     calday3light.gam,
     calday3temppCO2.gam,
     calday3temppCO2inter.gam,
     calday3templight.gam,
     calday3templightinter.gam, 
     calday3pco2light.gam,
     calday3pco2lightinter.gam,
     calday3lighttemppco2.gam,
     calday3lighttemppCO2inter.gam,
     calday3lightoarpco2.gam, 
     calday3lightoarpco2inter.gam,
     calday3temppCO2cover.gam,
     calday3temppCO2coverinter.gam,
     calday3tempcoverlight.gam, 
     calday3tempcoverlightinter.gam,
     calday3tempcoverOar.gam,
     calday3tempcoverOarinter.gam,
     newmodel.gamL,
     newmodel.gamstat, 
     newmodelphoto.gamstat)
```

```{r}
round(Weights(AICc(calday3temp.gam,
     calday3pco2.gam,
     calday3OAr.gam,
     calday3light.gam,
     calday3temppCO2.gam,
     calday3temppCO2inter.gam,
     calday3templight.gam,
     calday3templightinter.gam, 
     calday3pco2light.gam,
     calday3pco2lightinter.gam,
     calday3lighttemppco2.gam,
     calday3lighttemppCO2inter.gam,
     calday3lightoarpco2.gam, 
     calday3lightoarpco2inter.gam,
     calday3temppCO2cover.gam,
     calday3temppCO2coverinter.gam,
     calday3tempcoverlight.gam, 
     calday3tempcoverlightinter.gam,
     calday3tempcoverOar.gam,
     calday3tempcoverOarinter.gam,
     newmodel.gamL, 
     newmodel.gamstat, 
newmodelphoto.gamstat)),3)
```
```{r}
#str(summary(newmodel.gamstat))
```

#Now, we know using the GAM that incoporates temp pCO2 & cover of calcifiers is the best. Looking at the plots/edf of 1.00, we decide that the pCO2 gam is 'better'simpler' as linear. We also decide that temperature is better as a 2 factorial polynomial. We choose newmodel.gamstat as it is the 'simplest model within 2 AICc's' and has the best AICc weight.
```{r}
summary(newmodelphoto.gamstat)
par(mfrow=c(2,2))
gam.check(newmodelphoto.gamstat, pch=16)
```
```{r}
summary(newmodel.gamHali)
par(mfrow=c(2,2))
gam.check(newmodel.gamHali, pch=16)
```


```{r}
plot.gam(newmodel.gamstat, 
     pages=5,
     rug=F,
     ylab="Calcification", 
     xlab="Calcifying organisms",
     all.terms=TRUE, 
     shade=TRUE, 
     pch=16, cex=0.5,
     resid=T, 
     seWithMean=TRUE)
     #shift=-1.275
```

```{r}
plot.gam(newmodel.gamCoral, 
     pages=5,
     rug=F,
     ylab="Calcification", 
     xlab="Calcifying organisms",
     all.terms=TRUE, 
     shade=TRUE, 
     pch=16, cex=0.5,
     resid=T, 
     seWithMean=TRUE)
     #shift=-1.275
```


```{r}
plot.gam(newmodel.gamHali, 
     pages=5,
     rug=F,
     ylab="Calcification", 
     xlab="Calcifying organisms",
     all.terms=TRUE, 
     shade=TRUE, 
     pch=16, cex=0.5,
     resid=T, 
     seWithMean=TRUE)
     #shift=-1.275
```

```{r}
plot.gam(newmodel.gamstat, pages=5, all.terms=TRUE, shade=TRUE, pch=16, resid=T, seWithMean=TRUE, shift=1.275)
```


```{r}
jet.colors <-colorRampPalette(c("#4575b4", "#74add1", "#abd9e9",
                                "#e0f3f8", "#ffffbf", "#fee090", "#fdae61", "#f46d43", "#d73027"))

myvis.gam <- function (x, view = NULL, cond = list(), n.grid = 30, too.far = 0, 
          col = NA, color = "heat", contour.col = NULL, se = -1, type = "link", 
          plot.type = "persp", zlim = NULL, nCol = 50, ...) 
{
  fac.seq <- function(fac, n.grid) {
    fn <- length(levels(fac))
    gn <- n.grid
    if (fn > gn) 
      mf <- factor(levels(fac))[1:gn]
    else {
      ln <- floor(gn/fn)
      mf <- rep(levels(fac)[fn], gn)
      mf[1:(ln * fn)] <- rep(levels(fac), rep(ln, fn))
      mf <- factor(mf, levels = levels(fac))
    }
    mf
  }
  dnm <- names(list(...))
  v.names <- names(x$var.summary)
  if (is.null(view)) {
    k <- 0
    view <- rep("", 2)
    for (i in 1:length(v.names)) {
      ok <- TRUE
      if (is.matrix(x$var.summary[[i]])) 
        ok <- FALSE
      else if (is.factor(x$var.summary[[i]])) {
        if (length(levels(x$var.summary[[i]])) <= 1) 
          ok <- FALSE
      }
      else {
        if (length(unique(x$var.summary[[i]])) == 1) 
          ok <- FALSE
      }
      if (ok) {
        k <- k + 1
        view[k] <- v.names[i]
      }
      if (k == 2) 
        break
    }
    if (k < 2) 
      stop("Model does not seem to have enough terms to do anything useful")
  }
  else {
    if (sum(view %in% v.names) != 2) 
      stop(paste(c("view variables must be one of", v.names), 
                 collapse = ", "))
    for (i in 1:2) if (!inherits(x$var.summary[[view[i]]], 
                                 c("numeric", "factor"))) 
      stop("Don't know what to do with parametric terms that are not simple numeric or factor variables")
  }
  ok <- TRUE
  for (i in 1:2) if (is.factor(x$var.summary[[view[i]]])) {
    if (length(levels(x$var.summary[[view[i]]])) <= 1) 
      ok <- FALSE
  }
  else {
    if (length(unique(x$var.summary[[view[i]]])) <= 1) 
      ok <- FALSE
  }
  if (!ok) 
    stop(paste("View variables must contain more than one value. view = c(", 
               view[1], ",", view[2], ").", sep = ""))
  if (is.factor(x$var.summary[[view[1]]])) 
    m1 <- fac.seq(x$var.summary[[view[1]]], n.grid)
  else {
    r1 <- range(x$var.summary[[view[1]]])
    m1 <- seq(r1[1], r1[2], length = n.grid)
  }
  if (is.factor(x$var.summary[[view[2]]])) 
    m2 <- fac.seq(x$var.summary[[view[2]]], n.grid)
  else {
    r2 <- range(x$var.summary[[view[2]]])
    m2 <- seq(r2[1], r2[2], length = n.grid)
  }
  v1 <- rep(m1, n.grid)
  v2 <- rep(m2, rep(n.grid, n.grid))
  newd <- data.frame(matrix(0, n.grid * n.grid, 0))
  for (i in 1:length(x$var.summary)) {
    ma <- cond[[v.names[i]]]
    if (is.null(ma)) {
      ma <- x$var.summary[[i]]
      if (is.numeric(ma)) 
        ma <- ma[2]
    }
    if (is.matrix(x$var.summary[[i]])) 
      newd[[i]] <- matrix(ma, n.grid * n.grid, ncol(x$var.summary[[i]]), 
                          byrow = TRUE)
    else newd[[i]] <- rep(ma, n.grid * n.grid)
  }
  names(newd) <- v.names
  newd[[view[1]]] <- v1
  newd[[view[2]]] <- v2
  if (type == "link") 
    zlab <- paste("linear predictor")
  else if (type == "response") 
    zlab <- type
  else stop("type must be \"link\" or \"response\"")
  fv <- predict.gam(x, newdata = newd, se.fit = TRUE, type = type)
  z <- fv$fit
  if (too.far > 0) {
    ex.tf <- exclude.too.far(v1, v2, x$model[, view[1]], 
                             x$model[, view[2]], dist = too.far)
    fv$se.fit[ex.tf] <- fv$fit[ex.tf] <- NA
  }
  if (is.factor(m1)) {
    m1 <- as.numeric(m1)
    m1 <- seq(min(m1) - 0.5, max(m1) + 0.5, length = n.grid)
  }
  if (is.factor(m2)) {
    m2 <- as.numeric(m2)
    m2 <- seq(min(m1) - 0.5, max(m2) + 0.5, length = n.grid)
  }
  if (se <= 0) {
    old.warn <- options(warn = -1)
    av <- matrix(c(0.5, 0.5, rep(0, n.grid - 1)), n.grid, 
                 n.grid - 1)
    options(old.warn)
    max.z <- max(z, na.rm = TRUE)
    z[is.na(z)] <- max.z * 10000
    z <- matrix(z, n.grid, n.grid)
    surf.col <- t(av) %*% z %*% av
    surf.col[surf.col > max.z * 2] <- NA
    if (!is.null(zlim)) {
      if (length(zlim) != 2 || zlim[1] >= zlim[2]) 
        stop("Something wrong with zlim")
      min.z <- zlim[1]
      max.z <- zlim[2]
    }
    else {
      min.z <- min(fv$fit, na.rm = TRUE)
      max.z <- max(fv$fit, na.rm = TRUE)
    }
    surf.col <- surf.col - min.z
    surf.col <- surf.col/(max.z - min.z)
    surf.col <- round(surf.col * nCol)
    con.col <- 1
    if (color == "heat") {
      pal <- heat.colors(nCol)
      con.col <- 3
    }
    else if (color == "topo") {
      pal <- topo.colors(nCol)
      con.col <- 2
    }
    else if (color == "cm") {
      pal <- cm.colors(nCol)
      con.col <- 1
    }
    else if (color == "terrain") {
      pal <- terrain.colors(nCol)
      con.col <- 2
    }
    else if (color == "gray" || color == "bw") {
      pal <- gray(seq(0.1, 0.9, length = nCol))
      con.col <- 1
    }
    ### customized here
    else if (color == 'jet') {
      pal <- jet.colors(nCol)
      con.col = 1
    }
    ####
    else stop("color scheme not recognised")
    if (is.null(contour.col)) 
      contour.col <- con.col
    surf.col[surf.col < 1] <- 1
    surf.col[surf.col > nCol] <- nCol
    if (is.na(col)) 
      col <- pal[as.array(surf.col)]
    z <- matrix(fv$fit, n.grid, n.grid)
    if (plot.type == "contour") {
      stub <- paste(ifelse("xlab" %in% dnm, "", ",xlab=view[1]"), 
                    ifelse("ylab" %in% dnm, "", ",ylab=view[2]"), 
                    ifelse("main" %in% dnm, "", ",main=zlab"), ",...)", 
                    sep = "")
      if (color != "bw") {
        txt <- paste("image(m1,m2,z,col=pal,zlim=c(min.z,max.z)", 
                     stub, sep = "")
        eval(parse(text = txt))
        txt <- paste("contour(m1,m2,z,col=contour.col,zlim=c(min.z,max.z)", 
                     ifelse("add" %in% dnm, "", ",add=TRUE"), ",...)", 
                     sep = "")
        eval(parse(text = txt))
      }
      else {
        txt <- paste("contour(m1,m2,z,col=1,zlim=c(min.z,max.z)", 
                     stub, sep = "")
        eval(parse(text = txt))
      }
    }
    else {
      stub <- paste(ifelse("xlab" %in% dnm, "", ",xlab=view[1]"), 
                    ifelse("ylab" %in% dnm, "", ",ylab=view[2]"), 
                    ifelse("main" %in% dnm, "", ",zlab=zlab"), ",...)", 
                    sep = "")
      if (color == "bw") {
        op <- par(bg = "white")
        txt <- paste("persp(m1,m2,z,col=\"white\",zlim=c(min.z,max.z) ", 
                     stub, sep = "")
        eval(parse(text = txt))
        par(op)
      }
      else {
        txt <- paste("persp(m1,m2,z,col=col,zlim=c(min.z,max.z)", 
                     stub, sep = "")
        eval(parse(text = txt))
      }
    }
  }
  else {
    if (color == "bw" || color == "gray") {
      subs <- paste("grey are +/-", se, "s.e.")
      lo.col <- "gray"
      hi.col <- "gray"
    }
    else {
      subs <- paste("red/green are +/-", se, "s.e.")
      lo.col <- "green"
      hi.col <- "red"
    }
    if (!is.null(zlim)) {
      if (length(zlim) != 2 || zlim[1] >= zlim[2]) 
        stop("Something wrong with zlim")
      min.z <- zlim[1]
      max.z <- zlim[2]
    }
    else {
      z.max <- max(fv$fit + fv$se.fit * se, na.rm = TRUE)
      z.min <- min(fv$fit - fv$se.fit * se, na.rm = TRUE)
    }
    zlim <- c(z.min, z.max)
    z <- fv$fit - fv$se.fit * se
    z <- matrix(z, n.grid, n.grid)
    if (plot.type == "contour") 
      warning("sorry no option for contouring with errors: try plot.gam")
    stub <- paste(ifelse("xlab" %in% dnm, "", ",xlab=view[1]"), 
                  ifelse("ylab" %in% dnm, "", ",ylab=view[2]"), ifelse("zlab" %in% 
                                                                         dnm, "", ",zlab=zlab"), ifelse("sub" %in% dnm, 
                                                                                                        "", ",sub=subs"), ",...)", sep = "")
    txt <- paste("persp(m1,m2,z,col=col,zlim=zlim", ifelse("border" %in% 
                                                             dnm, "", ",border=lo.col"), stub, sep = "")
    eval(parse(text = txt))
    par(new = TRUE)
    z <- fv$fit
    z <- matrix(z, n.grid, n.grid)
    txt <- paste("persp(m1,m2,z,col=col,zlim=zlim", ifelse("border" %in% 
                                                             dnm, "", ",border=\"black\""), stub, sep = "")
    eval(parse(text = txt))
    par(new = TRUE)
    z <- fv$fit + se * fv$se.fit
    z <- matrix(z, n.grid, n.grid)
    txt <- paste("persp(m1,m2,z,col=col,zlim=zlim", ifelse("border" %in% 
                                                             dnm, "", ",border=hi.col"), stub, sep = "")
    eval(parse(text = txt))
  }
}
```


```{r}
calday3D<-myvis.gam(newmodel.gamstat,ticktype='detailed',type='response',
        color='jet', theta=40,phi=20) 
calday3D
```

```{r}
caldayerror<-myvis.gam(newmodel.gamstat,ticktype='detailed',type='response',
        color='jet', theta=40,phi=20, se=1) 
caldayerror
```
```{r}
library(itsadug)
fvisgam(newmodel.gamstat,rm.ranef=FALSE, view= c("Temp", "pCO2..CO2SYS.NBS"),color=c("#4575b4", "#74add1", "#abd9e9","#e0f3f8", "#ffffbf", "#fee090", "#fdae61", "#f46d43", "#d73027"),theta=40,phi=20)
```

```{r}
theme_set(theme_classic()+  theme(axis.text.x=element_text(hjust=0.5, size=12), 
        legend.justification=c(0,1),
        legend.position="none", 
        panel.background= element_rect(fill=NA, color='black'),
        axis.text.y = element_text(vjust=0.5, size=12), 
        axis.title.x = element_text(vjust=0.5, size=14),
        axis.title.y = element_text(vjust=0.5, size=14),
        legend.title = element_text(size=12),
        legend.title.align=0.5,
        legend.text = element_text(vjust=0.5, size=12)))
tempdaycal<- ggplot(calday3, aes(x= Temp, y=gCaCO3h.1m.2, color=Treatment))+
  geom_point(alpha=0.7)+
  geom_smooth(method="gam",
              formula= y ~ poly(x, 2),
              method.args=list(family="gaussian"), color='black', fill='grey39')+
  scale_color_manual("Treatment", values=c("Blue"= 'navy',"Green"= "mediumaquamarine", "Yellow"='orange2', "Red"= 'brown1'),
                    labels=c("Blue"="Present day", "Green"="RCP8.5 pCO2", "Yellow"="RCP8.5 temp", "Red"="RCP8.5 temp & pCO2"))+
  scale_x_continuous(expression(Temperature~(degree ~ C)), limits=c(20.0,32.5), breaks=c(20.0,22.5,25,27.5,30,32.5))+
  scale_y_continuous(expression(Net~ecosystem~calcification~(gCaC0[3]~'\U2219'~hr^{-1})),limits=c(-0.2,1.5), breaks=c(-0.25,0,0.25,0.5,0.75,1.00,1.25,1.5))+
  geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  geom_vline(xintercept = 27.3, linetype="dashed", color = 'black', size=1, show.legend = TRUE)
tempdaycal
```

```{r}
pco2daycal<- ggplot(calday3, aes(x= pCO2..CO2SYS.NBS, y=gCaCO3h.1m.2))+
  geom_point(color='black', alpha=0.7)+
  geom_smooth(method="lm",
              formula= y ~ x,
              method.args=list(family="gaussian"), color='black', fill='grey39')+
   scale_x_continuous(expression(pCO[2]~(mu~atm)), limits=c(200,1100), breaks=c(250,500,750,1000))+
  scale_y_continuous(expression(Net~ecosystem~calcification~(gCaC0[3]~'\U2219'~hr^{-1})),limits=c(-0.2,1.5), breaks=c(-0.25,0,0.25,0.5,0.75,1.00,1.25,1.5))+
  geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)
pco2daycal
```

```{r}
caldaycal<- ggplot(calday3, aes(x= Calcifiers, y=gCaCO3h.1m.2))+
  geom_point(aes(size=factor(Prop), color=factor(Prop), alpha=0.8))+
  geom_smooth(method="gam",
              formula= y ~ s(x, k=5),
              method.args=list(family="gaussian"), color='black', fill='grey39')+
   #scale_shape_manual("Prop", values=c("Coral"=(pch=16), "Algae"=(pch=8)))+
   scale_size_manual("Prop", values=c(4, 4))+
  scale_color_manual("Prop", values=c("Coral"="orange2", "Algae"="mediumaquamarine"))+
   scale_x_continuous(expression(Calcifying~organisms~("%")))+
  scale_y_continuous(expression(Net~ecosystem~calcification~(gCaC0[3]~'\U2219'~hr^{-1})),limits=c(-0.2,1.5), breaks=c(-0.25,0,0.25,0.5,0.75,1.00,1.25,1.5))+
  geom_hline(yintercept = 0.00, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)
caldaycal
```
##CALCIFICATION NIGHT
```{r}
calnight3<- read.csv("/Users/imkri/Desktop/Meso/Cal data Dec14-Dec 15 night.csv", strip.white=T)
calnight3
```


```{r}
calnight3temp.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3) 
calnight3pco2.gam <-gam(gCaCO3h.1m.2~
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3)
calnight3OAr.gam <-gam(gCaCO3h.1m.2~
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3)
calnight3temppCO2inter.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ 
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3)
calnight3temppCO2.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3) 
calnight3temppCO2cover.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3) 
calnight3tempcoverOar.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3) 
calnight3tempcoverOarti.gam <-gam(gCaCO3h.1m.2~
                 s(Temp, bs="tp", k=5)+
                 s(Calcifiers, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+
                 te(Temp, O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=calnight3) ##BEST MODEL
newmodelnight.gam <-gam(gCaCO3h.1m.2~
                 Temp+
                 O.Ar..CO2SYS.NBS+
                 Calcifiers+
                 s(Tank,bs="re")+
                 te(Temp, O.Ar..CO2SYS.NBS, bs="tp", k=5),data=calnight3) 
newmodelnight.gambest <-gam(gCaCO3h.1m.2~
                 Temp+
                 O.Ar..CO2SYS.NBS+
                 te(Temp, O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"),data=calnight3) 
```

```{r}
AICc(calnight3temp.gam,
     calnight3pco2.gam,
     calnight3OAr.gam,
     calnight3temppCO2.gam,
     calnight3temppCO2inter.gam, 
     calnight3temppCO2cover.gam, 
     calnight3tempcoverOar.gam,
     calnight3tempcoverOarti.gam,
     newmodelnight.gam,
     newmodelnight.gambest)
```

```{r}
round(Weights(AICc(calnight3temp.gam,
     calnight3pco2.gam,
     calnight3OAr.gam,
     calnight3temppCO2.gam,
     calnight3temppCO2inter.gam, 
     calnight3temppCO2cover.gam, 
     calnight3tempcoverOar.gam,
     calnight3tempcoverOarti.gam,
     newmodelnight.gam,
     newmodelnight.gambest)),3)
```

```{r}
#str(summary(newmodelnight.gambest))
```

```{r}
summary(newmodelnight.gambest)
par(mfrow=c(2,2))
gam.check(newmodelnight.gambest, pch=16)
```

```{r}
plot(newmodelnight.gambest, pages=1, all.terms=TRUE, shade=TRUE, pch=16, resid=FALSE, seWithMean=TRUE)
```

```{r}
calnight3D<-myvis.gam(newmodelnight.gambest,
                      ticktype='detailed', 
                      type='response',
                      color='jet', 
                      theta=40,phi=20)
calnight3D
```
```{r}
calnighterror<-myvis.gam(newmodelnight.gambest,ticktype='detailed',type='response',
        color='jet', theta=40,phi=20, se=1)
calnighterror
```

```{r}
fvisgam(newmodelnight.gambest,rm.ranef=FALSE, view= c("Temp", "O.Ar..CO2SYS.NBS"), color=c("#4575b4", "#74add1", "#abd9e9","#e0f3f8", "#ffffbf", "#fee090", "#fdae61", "#f46d43", "#d73027"),theta=40,phi=20)
```

```{r}
o2day3<- read.csv("/Users/imkri/Desktop/Meso/Cal data Dec14- Dec15 day.csv", strip.white=T)
o2day3
```


```{r}
o2day3temp.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3) 
o2day3pco2.gam <-gam(O2~
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3light.gam <-gam(O2~
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3OAr.gam <-gam(O2~
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3templight.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+
                 s(Tank,bs="re"), data=o2day3)
o2day3templightinter.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+
                 te(Temp,Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3pco2light.gam <-gam(O2~
                 s(Light, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3lighttemppco2.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3lightoartemp.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3lighttemppCO2inter.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ 
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3temppCO2inter.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ 
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3) 
o2day3temppCO2.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"),data=o2day3) 
o2day3temppCO2coverti.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3) 
o2day3tempcoverlight.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3) 
o2day3tempcoverOar.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3lightpco2cover.gam <-gam(O2~
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+
                 te(pCO2..CO2SYS.NBS, Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2day3tempcoverlightpco2.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2daynew.gam1 <-gam(O2~
                 s(Light, bs="tp", k=5)+
                 pCO2..CO2SYS.NBS+
                 Photosynthesizers+
                 te(pCO2..CO2SYS.NBS, Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
o2daynew.gampoly <-gam(O2~
                 poly(Light,2, raw="TRUE")+
                 pCO2..CO2SYS.NBS+
                 Photosynthesizers+
                 te(pCO2..CO2SYS.NBS, Light, bs="tp", k=5)+ s(Tank,bs="re"), data=o2day3)
```

```{r}
AICc(o2day3temp.gam,
     o2day3pco2.gam,
     o2day3light.gam,
     o2day3OAr.gam,
     o2day3templight.gam,
     o2day3templightinter.gam,  
     o2day3pco2light.gam,
     o2day3lightoartemp.gam, 
     o2day3lighttemppco2.gam,
     o2day3lighttemppCO2inter.gam, 
     o2day3temppCO2.gam,
     o2day3temppCO2inter.gam, 
     o2day3tempcoverlight.gam,
     o2day3tempcoverOar.gam,
     o2day3temppCO2coverti.gam, 
     o2day3lightpco2cover.gam, 
     o2day3tempcoverlightpco2.gam,
     o2daynew.gam1, 
     o2daynew.gampoly)
```
```{r}
round(Weights(AICc(o2day3temp.gam,
     o2day3pco2.gam,
     o2day3light.gam,
     o2day3OAr.gam,
     o2day3templight.gam,
     o2day3templightinter.gam,  
     o2day3pco2light.gam,
     o2day3lightoartemp.gam, 
     o2day3lighttemppco2.gam,
     o2day3lighttemppCO2inter.gam, 
     o2day3temppCO2.gam,
     o2day3temppCO2inter.gam, 
     o2day3tempcoverlight.gam,
     o2day3tempcoverOar.gam,
     o2day3temppCO2coverti.gam, 
     o2day3lightpco2cover.gam, 
     o2day3tempcoverlightpco2.gam,
     o2daynew.gam1, 
     o2daynew.gampoly)),3)
```

```{r}
#str(summary(o2daynew.gam1))
```

```{r}
summary(o2daynew.gam1)
par(mfrow=c(2,2))
gam.check(o2daynew.gam1, pch=16)
```

```{r}
plot(o2daynew.gam1, pages=1, all.terms=TRUE, shade=TRUE, pch=16, resid=FALSE, seWithMean=TRUE)
```

```{r}
o2day3d<-myvis.gam(o2daynew.gam1,
        ticktype='detailed',
        type='response',
        color='jet',
        view= c("Light", "pCO2..CO2SYS.NBS"),
        theta=-30,
        phi=30)
o2day3d
```


```{r}
o2dayerror<-myvis.gam(o2daynew.gam1,
        ticktype='detailed',
        type='response',
        view= c("Light", "pCO2..CO2SYS.NBS"),
        color='jet',
        theta=-30,
        phi=30, se=1)
o2dayerror
```

```{r}
fvisgam(o2daynew.gam1,
        #rm.ranef=FALSE, 
        view= c("Light", "pCO2..CO2SYS.NBS"),
        color=c("grey"),
        ticktype='detailed',
        #theta=-10,
        #phi=-10, 
        plot.type = "persp",
        ylim =c(380,440))
```
```{r}
fvisgam(o2daynew.gam1,
        #rm.ranef=FALSE, 
        view= c("Light", "pCO2..CO2SYS.NBS"),
        color=c("grey"),se=1,
        #theta=-10,
        #phi=-10,
        plot.type = "persp",
        ylim =c(380,440))
```
```{r}
fvisgam(o2daynew.gam1,
        #rm.ranef=FALSE, 
        view= c("Light", "pCO2..CO2SYS.NBS"),
        color=c("grey"),
        #theta=-10,
        #phi=-10,
        plot.type = "persp",
        ylim =c(380,440))
```


```{r}
fvisgam(o2daynew.gam1,
        rm.ranef=FALSE, 
        view= c("Light", "pCO2..CO2SYS.NBS"),
        color=c("#4575b4", "#74add1", "#abd9e9","#e0f3f8", "#ffffbf", "#fee090", "#fdae61", "#f46d43", "#d73027"),
        theta=-30,
        phi=30)
```

```{r}
o2night3<- read.csv("/Users/imkri/Desktop/Meso/Cal data Dec14-Dec 15 night.csv", strip.white=T)
o2night3
```
```{r}
o2night3temp.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+ s(Tank,bs="re"), data=o2night3) 
o2night3pco2.gam <-gam(O2~
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2night3)
o2night3OAr.gam <-gam(O2~
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2night3)
o2night3temppCO2.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2night3)
o2night3temppCO2inter.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 te(Temp,pCO2..CO2SYS.NBS,bs="cr", k=5)+s(Tank,bs="re"), data=o2night3) 
o2night3temppCO2cover.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+ s(Tank,bs="re"), data=o2night3) 
o2night3temppCO2coverti.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(pCO2..CO2SYS.NBS, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+
                 te(Temp,pCO2..CO2SYS.NBS,bs="cr", k=5)+ s(Tank,bs="re"), data=o2night3) 
o2night3tempcoverOar.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 s(Photosynthesizers, bs="tp", k=5)+
                 s(O.Ar..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2night3)
newo2night.gam <-gam(O2~
                 s(Temp, bs="tp", k=5)+
                 pCO2..CO2SYS.NBS+ 
                 te(Temp,pCO2..CO2SYS.NBS, bs="tp", k=5)+ s(Tank,bs="re"), data=o2night3) 
```

```{r}
AICc(o2night3temp.gam,
     o2night3pco2.gam,
     o2night3OAr.gam,
     o2night3temppCO2.gam,
     o2night3temppCO2inter.gam,
     o2night3temppCO2cover.gam,
     o2night3temppCO2coverti.gam,
     o2night3tempcoverOar.gam,
     newo2night.gam)
```
```{r}
round(Weights(AICc(o2night3temp.gam,
     o2night3pco2.gam,
     o2night3OAr.gam,
     o2night3temppCO2.gam,
     o2night3temppCO2inter.gam,
     o2night3temppCO2cover.gam,
     o2night3temppCO2coverti.gam,
     o2night3tempcoverOar.gam,
     newo2night.gam)),3)
```
```{r}
#str(summary(newo2night.gam))
```

```{r}
summary(o2night3temp.gam)
par(mfrow=c(2,2))
gam.check(o2night3temp.gam, pch=16)
```

```{r}
plot(o2night3temp.gam, 
     all.terms=TRUE, 
     shade=TRUE, 
     pch=16, cex=2.5,
     resid=T, 
     seWithMean=TRUE, 
     rug=F)
```